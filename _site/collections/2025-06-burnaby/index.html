<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  
    <title>2025 06 Burnaby</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  

  <link rel="stylesheet" href="/assets/styles.css?v=2">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&family=Lora&display=swap" rel="stylesheet">

  <!-- PhotoSwipe CSS -->
  <link rel="stylesheet" href="https://unpkg.com/photoswipe@5/dist/photoswipe.css" />

  <!-- PhotoSwipe JS -->
  <script type="module">
    import PhotoSwipeLightbox from 'https://unpkg.com/photoswipe@5/dist/photoswipe-lightbox.esm.js';
    window.PhotoSwipeLightbox = PhotoSwipeLightbox;
  </script>

  <!-- Eleventy Live Reload -->
  <script type="module"
    integrity="sha512-7Y25+FX/kRUbZEHtQBOSLffzofBxz8ABQErLAVpGkfzactkpJU5wtTmhIfIZeTw7VHg1JeTIC5kHkzPq7LqR1w=="
    src="/.11ty/reload-client.js"></script>
</head>

<body class="site-body">
  <nav class="floating-nav">
    <div class="brand">XY</div>
    <button class="nav-toggle" aria-label="Toggle navigation">‚ò∞</button>
    <ul class="nav-links">
      <li><a href="/">Home</a></li>
      <li><a href="/posts">Posts</a></li>
      <li><a href="/collections">Collections</a></li>
      <li><a href="/about">About</a></li>
      <li><a href="/login/">Login</a></li>
    </ul>
  </nav>

  <header></header>

  <main class="site-main">
    <div class="container">
      


<main class="site-main">
  <div class="container">
    
    <section class="collection-detail page-offset">
      <h1>2025 06 Burnaby</h1>
      
      <p class="photo-count" id="photo-count">
        2 photos
      </p>
    </section>


    <h3>Public Gallery test</h3>
    <!-- Public Gallery -->
    <div id="public-gallery" class="collection-gallery">
      
      
      <img data-photo="public/2025-06-burnaby-photo-1_thumb.jpeg" class="collection-photo supabase-image"
        alt="2025 06 Burnaby" loading="lazy" />
      
      
      
      <img data-photo="public/2025-06-burnaby-photo-2_thumb.jpeg" class="collection-photo supabase-image"
        alt="2025 06 Burnaby" loading="lazy" />
      
      
    </div>
    <div id="public-gallery-empty" style="display: none;">No public images available.</div>


    <!-- Gated Gallery Container -->

    <div id="gated-gallery-container">
      <h3>Member Gallery</h3>
      <div id="member-gallery" class="collection-gallery">
        <div class="gallery-loading-message">Loading member images...</div>
      </div>
      <p id="member-gallery-empty" style="display: none;">No member images available.</p>

      <h3>Premium Gallery</h3>
      <div id="premium-gallery" class="collection-gallery">
        <div class="gallery-loading-message">Loading premium images...</div>
      </div>
      <p id="premium-gallery-empty" style="display: none;">No premium images available.</p>
    </div>



    <!-- PhotoSwipe Lightbox root markup -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="pswp__bg"></div>
      <div class="pswp__scroll-wrap">
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <div class="pswp__ui pswp__ui--hidden"></div>
      </div>
    </div>

    <script>
      window.SUPABASE_CONFIG = JSON.parse('{"url":"https://kaqqyhjsvddvfxtyhmak.supabase.co","anonKey":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImthcXF5aGpzdmRkdmZ4dHlobWFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NjIyNDcsImV4cCI6MjA3MTAzODI0N30.qqxi-RQ0bTQZu-3JfHJTroaKam_JeEjw7R8CKjXVyas"}');
      window.GALLERY_DATA = {
        accessLevel: "public",
        memberImages: [],
        premiumImages: []
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const { url, anonKey } = window.SUPABASE_CONFIG;
        const supabase = window.supabaseClient || window.Supabase.createClient(url, anonKey);

        // Load public images
        const publicImages = document.querySelectorAll('.supabase-image[data-photo]');
        for (const img of publicImages) {
          const path = img.dataset.photo;
          if (!path) continue;
          const { data, error } = await supabase.storage.from('photos').createSignedUrl(path, 3600);
          if (data?.signedUrl) {
            img.src = data.signedUrl;
            img.classList.add('loaded');
          } else {
            console.warn("‚ùå Failed to sign public image:", path, error);
            img.alt = 'Image unavailable';
          }
        }

        // Render gated galleries
        const { accessLevel, memberImages, premiumImages } = window.GALLERY_DATA;

        const renderGallery = async (images, containerId, galleryType, emptyId) => {
          const container = document.getElementById(containerId);
          const emptyMessage = document.getElementById(emptyId);
          if (!container) return;

          console.log(`üîç Rendering ${galleryType} gallery with ${images.length} images`);
          container.innerHTML = ''; // Clear placeholder

          if (!images || images.length === 0) {
            if (emptyMessage) emptyMessage.style.display = 'block';
            return;
          }

          for (const image of images) {
            console.log("üñºÔ∏è Image object:", image);

            const hasAccess =
              (accessLevel === 'premium') ||
              (accessLevel === 'member' && galleryType === 'member');

            const thumbPath = hasAccess ? image.thumb : image.blur;
            const fullPath = hasAccess ? image.full : null;

            if (!thumbPath) {
              console.warn("‚ö†Ô∏è No thumbnail path found for image:", image);
              continue;
            }

            const { data, error } = await supabase.storage.from('photos').createSignedUrl(thumbPath, 3600);
            if (!data?.signedUrl) {
              console.warn("‚ùå Failed to sign gated image:", thumbPath, error);
              continue;
            }

            const img = document.createElement('img');
            img.className = 'collection-photo supabase-image';
            img.alt = image.alt || 'Untitled';
            img.src = data.signedUrl;

            if (fullPath && hasAccess) {
              img.setAttribute('data-full', fullPath);
              img.classList.add('lightbox-enabled');
            } else {
              img.classList.add('lightbox-disabled');
            }

            container.appendChild(img);
            console.log("üì¶ Appended image to", containerId);
          }
        };

        await renderGallery(memberImages, 'member-gallery', 'member', 'member-gallery-empty');
        await renderGallery(premiumImages, 'premium-gallery', 'premium', 'premium-gallery-empty');
      });
    </script>
    
  </div>
</main>
    </div>
  </main>

  <div id="userStatus" class="user-status"></div>

  <footer class="site-footer">
    <nav class="footer-nav">
      <a href="/">Home</a>
      <a href="/posts">Posts</a>
      <a href="/collections">Collections</a>
      <a href="/about">About</a>
      <a href="https://instagram.com/mc88xx" target="_blank">Instagram</a>
    </nav>

    <div class="footer-meta">
      <p>¬© <span id="year"></span> xy.remainoff.com ¬∑ stillness in frames ¬∑ Images may not be reproduced without
        permission.</p>
    </div>
  </footer>


  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js" defer></script>
  <script src="/assets/auth.js" defer></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.querySelector(".nav-toggle");
      const navLinks = document.querySelector(".nav-links");
      toggle?.addEventListener("click", () => {
        navLinks?.classList.toggle("active");
      });
    });
  </script>

  <script>
    window.SUPABASE_CONFIG = JSON.parse('{"url":"https://kaqqyhjsvddvfxtyhmak.supabase.co","anonKey":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImthcXF5aGpzdmRkdmZ4dHlobWFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NjIyNDcsImV4cCI6MjA3MTAzODI0N30.qqxi-RQ0bTQZu-3JfHJTroaKam_JeEjw7R8CKjXVyas"}');
  </script>
</body>

</html>