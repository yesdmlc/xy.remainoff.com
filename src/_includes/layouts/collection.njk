---
layout: layouts/base.njk
title: Collection
user:
  access_level: public
---
<section class="collection-detail page-offset">
  <h1>{{ galleryEntry.title }}</h1>
  {% if galleryEntry.subtitle %}
    <p class="subtitle">{{ galleryEntry.subtitle }}</p>
  {% endif %}
  <p class="photo-count" id="photo-count">
    {{ galleryEntry.photo_count or 0 }} photo{% if (galleryEntry.photo_count or 0) != 1 %}s{% endif %}
  </p>
</section>

<pre>{{ galleryEntry | dump }}</pre> <!-- Debug output updated -->

<!-- Public Gallery -->
<div id="public-gallery" class="collection-gallery">
  {% for image in galleryEntry.images %}
    <img
      data-photo="{{ image.path }}"
      class="collection-photo supabase-image"
      alt="{{ image.alt or galleryEntry.title }}"
      loading="lazy"
    />
  {% endfor %}
</div>
<div id="public-gallery-empty" style="display: none;">No public images available.</div>

<!-- Gated Gallery Reveal Button -->
<button id="load-gated-gallery" style="display: none;"></button>
<div id="gallery-loader" style="display: none;">Loading...</div>

<!-- Gated Gallery Container -->
<div id="gated-gallery-container" style="display: none;">
  <h3>Member Gallery</h3>
  <div id="member-gallery" class="collection-gallery"></div>

  <h3>Premium Gallery</h3>
  <div id="premium-gallery" class="collection-gallery"></div>
</div>

<!-- PhotoSwipe Lightbox root markup -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="pswp__bg"></div>
  <div class="pswp__scroll-wrap">
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    <div class="pswp__ui pswp__ui--hidden"></div>
  </div>
</div>

<script>
  window.SUPABASE_CONFIG = JSON.parse('{{ "" | supabaseConfig | safe }}');
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const { url, anonKey } = window.SUPABASE_CONFIG;
    const supabase = window.supabaseClient || window.Supabase.createClient(url, anonKey);
    const images = document.querySelectorAll('.supabase-image[data-photo]');
    for (const img of images) {
      const path = img.dataset.photo;
      if (!path) continue;
      const { data, error } = await supabase.storage.from('photos').createSignedUrl(path, 3600);
      if (data && data.signedUrl) {
        img.src = data.signedUrl;
        img.classList.add('loaded');
      } else {
        img.alt = 'Image unavailable';
      }
    }
  });
</script>